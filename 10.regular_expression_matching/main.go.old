package main

import "fmt"

func main() {
	fmt.Println(isMatch("aaa", "a*a"))
}

func isMatch(s string, p string) bool {
	templateBytes := []byte(p)
	inputBytes := []byte(s)

	ibLength := len(inputBytes)
	tbLength := len(templateBytes)

	if tbLength < ibLength {
		return false
	}

	if tbLength > 1 && templateBytes[1] == '*' {
		if templateBytes[0] != inputBytes[0] && templateBytes[0] != '.' {
			templateBytes = templateBytes[2:]
			tbLength -= 2
		}
	}

	// check for stars
	starPos := make(map[int]byte)

	for i, v := range templateBytes {
		if v == '*' {
			starPos[i] = templateBytes[i-1]
		}
	}

	stars := len(starPos) > 0

	if !stars && tbLength != ibLength {
		return false
	}

	inCounter := 0
	tCounter := 0

	for inCounter < ibLength {
		if _, exists := starPos[inCounter]; exists {
			symbol := starPos[inCounter]

			if inputBytes[inCounter] != symbol && symbol != '.' {
				inCounter++
				tCounter++

				continue
			}

			if symbol == '.' {
				cs := inputBytes[inCounter]

				for inCounter < ibLength && inputBytes[inCounter] == cs {
					inCounter++
				}

				tCounter++

				continue
			}

			for inCounter < ibLength && inputBytes[inCounter] == symbol {
				inCounter++
			}

			tCounter++
		} else {
			if templateBytes[tCounter] != inputBytes[inCounter] && templateBytes[tCounter] != '.' && !stars {
				return false
			}

			inCounter++
			tCounter++
		}
	}

	return tbLength <= tCounter
}
